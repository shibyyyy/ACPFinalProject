{%extends "base.html"%}
{%block title%}
    <title>Achievements & Rewards - VocabuLearner Admin</title>
{%endblock%}

{%block content%}
{%block logo_link %}
            <a href="{{ url_for('admin_dashboard') }}" class="logo-link">
                <div class="logo-icon">
                    <div class="pokeball-mini"></div>
                    <div class="pokeball-mini"></div>
                    <div class="pokeball-mini"></div>
                </div>
                VocabuLearner
            </a>
    {% endblock %}
    {%block header%}
        <div class="header-actions">
            <button class="back-btn" onclick="goToDashboard()">Back to Dashboard</button>
            <button class="logout-btn" onclick="showLogoutConfirm()">Logout</button>
        </div>
    {%endblock%}

    <style>
        /* Achievements Specific Styles */
        .management-container { 
            margin-top: 120px; 
            max-width: 1400px; 
            margin-left: auto; 
            margin-right: auto; 
            padding: 20px; 
            position: relative; 
            z-index: 10; 
        }

        /* Page Header */
        .page-header { 
            background: rgba(255,255,255,0.15); 
            backdrop-filter: blur(10px); 
            border: 4px solid #000; 
            padding: 25px; 
            margin-bottom: 30px; 
            box-shadow: 8px 8px 0 #000; 
            text-align: center;
        }
        .page-header h1 { 
            font-size: 24px; 
            color: #ffd700; 
            text-shadow: 4px 4px 0 #000; 
            margin-bottom: 15px; 
        }
        .page-header p { 
            font-size: 12px; 
            color: #fff; 
            text-shadow: 2px 2px 0 #000; 
            margin-bottom: 20px; 
        }

        /* Buttons */
        .back-btn {
            background: #4169e1;
            color: #fff;
            border: 3px solid #000;
            padding: 8px 15px;
            font-size: 10px;
            box-shadow: 4px 4px 0 #000;
            cursor: pointer;
            text-transform: uppercase;
            font-family: 'Press Start 2P', monospace;
            transition: all 0.2s;
        }
        .back-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
            background: #3558c7;
        }

        .logout-btn {
            background: #ff4444;
            color: #fff;
            border: 3px solid #000;
            padding: 8px 15px;
            font-size: 10px;
            box-shadow: 4px 4px 0 #000;
            cursor: pointer;
            text-transform: uppercase;
            font-family: 'Press Start 2P', monospace;
            transition: all 0.2s;
        }
        .logout-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
            background: #ff3333;
        }

        .action-btn {
            background: #4169e1;
            color: #fff;
            border: 3px solid #000;
            padding: 8px 12px;
            font-size: 8px;
            box-shadow: 3px 3px 0 #000;
            cursor: pointer;
            text-transform: uppercase;
            font-family: 'Press Start 2P', monospace;
            transition: all 0.2s;
        }
        .action-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #000;
        }
        
        .action-btn.green {
            background: #76c442;
        }
        
        .action-btn.red {
            background: #ff4444;
        }

        /* Achievements Grid */
        .achievements-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .achievement-card { 
            background: rgba(255,255,255,0.15); 
            backdrop-filter: blur(10px); 
            border: 4px solid #000; 
            padding: 20px; 
            box-shadow: 8px 8px 0 #000; 
        }
        .achievement-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .achievement-title { 
            font-size: 14px; 
            color: #ffd700; 
            text-shadow: 3px 3px 0 #000; 
        }
        .achievement-icon { 
            font-size: 32px; 
        }
        .achievement-desc { 
            font-size: 10px; 
            color: #fff; 
            text-shadow: 1px 1px 0 #000; 
            margin-bottom: 15px; 
            line-height: 1.5; 
        }
        .achievement-stats { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 15px; 
        }
        .achievement-stat { 
            text-align: center; 
        }
        .stat-label { 
            font-size: 8px; 
            color: #fff; 
            opacity: 0.8; 
        }
        .stat-number { 
            font-size: 12px; 
            color: #ffd700; 
            text-shadow: 2px 2px 0 #000; 
        }
        .achievement-actions { 
            display: flex; 
            gap: 10px; 
        }

        /* Add Achievement Form */
        .add-achievement-form { 
            background: rgba(255,255,255,0.15); 
            backdrop-filter: blur(10px); 
            border: 4px solid #000; 
            padding: 25px; 
            margin-bottom: 30px; 
            box-shadow: 8px 8px 0 #000; 
        }
        .form-row { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        .form-group { 
            margin-bottom: 15px; 
            position: relative;
        }
        .form-label { 
            display: block; 
            font-size: 10px; 
            color: #ffd700; 
            text-shadow: 2px 2px 0 #000; 
            margin-bottom: 8px; 
        }
        .form-input { 
            width: 100%; 
            padding: 12px; 
            border: 3px solid #000; 
            background: rgba(255,255,255,0.9); 
            font-family: 'Press Start 2P', monospace; 
            font-size: 10px; 
            box-shadow: 4px 4px 0 #000; 
        }
        .select-pokemon-btn {
            width: 100%;
            padding: 12px;
            border: 3px solid #000;
            background: rgba(255,255,255,0.9);
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            box-shadow: 4px 4px 0 #000;
            cursor: pointer;
            text-align: left;
            color: #333;
        }
        .select-pokemon-btn:hover {
            background: rgba(255,255,255,1);
        }
        .form-actions { 
            display: flex; 
            gap: 15px; 
            margin-top: 25px; 
        }

        /* Pok√©mon Selector Modal */
        .pokemon-selector-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .pokemon-selector-modal.active {
            display: flex;
        }
        .pokemon-selector-content {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border: 4px solid #000;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 12px 12px 0 #000;
        }
        .pokemon-selector-content h2 {
            font-size: 20px;
            color: #228b22;
            text-shadow: 3px 3px 0 #ffd700;
            margin-bottom: 20px;
            text-align: center;
        }
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .pokemon-option {
            background: rgba(255,255,255,0.9);
            border: 3px solid #000;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .pokemon-option:hover {
            transform: scale(1.05);
            background: rgba(255,215,0,0.3);
        }
        .pokemon-option.selected {
            background: rgba(76, 200, 66, 0.3);
            border-color: #4cc842;
        }
        .pokemon-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pokemon-icon img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }
        .pokemon-name {
            font-size: 9px;
            color: #000;
            font-weight: bold;
        }
        .pokemon-id {
            font-size: 8px;
            color: #666;
        }
        .pokemon-selector-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        /* Modal Styles */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.8); 
            z-index: 2000; 
            justify-content: center; 
            align-items: center; 
        }
        .modal.active { 
            display: flex; 
        }
        .modal-content { 
            background: rgba(255,255,255,0.95); 
            backdrop-filter: blur(10px); 
            border: 4px solid #000; 
            padding: 40px; 
            max-width: 500px; 
            width: 90%; 
            box-shadow: 12px 12px 0 #000; 
            text-align: center; 
        }
        .modal-content h2 { 
            font-size: 20px; 
            color: #228b22; 
            text-shadow: 3px 3px 0 #ffd700; 
            margin-bottom: 20px; 
        }
        .modal-content p { 
            font-size: 12px; 
            color: #000; 
            margin-bottom: 20px; 
            line-height: 1.6; 
        }
        .modal-actions { 
            display: flex; 
            gap: 10px; 
            justify-content: center; 
            margin-top: 20px; 
        }
        .btn-confirm { 
            background: #76c442; 
            color: #fff; 
            border: 4px solid #000; 
            padding: 12px 25px; 
            font-size: 12px; 
            box-shadow: 6px 6px 0 #000; 
            cursor: pointer; 
            font-family: 'Press Start 2P', monospace; 
        }
        .btn-cancel { 
            background: #ff4444; 
            color: #fff; 
            border: 4px solid #000; 
            padding: 12px 25px; 
            font-size: 12px; 
            box-shadow: 6px 6px 0 #000; 
            cursor: pointer; 
            font-family: 'Press Start 2P', monospace; 
        }
        .btn-confirm:hover, .btn-cancel:hover { 
            transform: translate(3px, 3px); 
            box-shadow: 3px 3px 0 #000; 
        }

        /* Selected Pok√©mon Display */
        .selected-pokemon-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border: 2px solid #000;
            border-radius: 5px;
        }
        .selected-pokemon-display img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }
        .selected-pokemon-info {
            font-size: 10px;
            color: #ffd700;
            text-shadow: 1px 1px 0 #000;
        }

        /* Responsive adjustments */
        @media (max-width: 900px) {
            .achievements-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header-actions {
                flex-wrap: wrap;
                justify-content: flex-end;
            }
            
            .pokemon-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>

    <div class="management-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>Achievements & Rewards</h1>
            <p>Configure achievement badges, requirements, and reward systems</p>
        </div>

        <!-- Add New Achievement Form -->
        <div class="add-achievement-form">
            <h2 style="color: #ffd700; text-shadow: 3px 3px 0 #000; margin-bottom: 20px; text-align: center;">Add New Achievement</h2>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Achievement Name</label>
                    <input type="text" class="form-input" placeholder="Enter achievement name" id="achieveName">
                </div>
                <div class="form-group">
                    <label class="form-label">Requirement (Number)</label>
                    <input type="number" class="form-input" placeholder="e.g., 100 (for 100 words)" id="achieveReq">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" placeholder="Enter description" id="achieveDesc">
                </div>
                <div class="form-group">
                    <label class="form-label">Reward</label>
                    <button type="button" class="select-pokemon-btn" onclick="showPokemonSelector()">
                        Select Pok√©mon Reward
                    </button>
                    <div id="selectedPokemonDisplay" class="selected-pokemon-display" style="display: none;">
                        <img id="selectedPokemonImg" src="" alt="Selected Pok√©mon">
                        <div id="selectedPokemonInfo" class="selected-pokemon-info"></div>
                    </div>
                    <input type="hidden" id="pokemonId" value="">
                    <input type="hidden" id="pokemonName" value="">
                </div>
            </div>
            
            <div class="form-actions">
                <button class="action-btn green" onclick="addAchievement()">Add Achievement</button>
                <button class="action-btn" onclick="clearForm()">Clear Form</button>
            </div>
        </div>

        <!-- Achievements Grid -->
        <div class="achievements-grid">
            <!-- Achievement cards will be loaded dynamically from database -->
            {% for achievement in achievements %}
            <div class="achievement-card">
                <div class="achievement-header">
                    <h3 class="achievement-title">{{ achievement.name }}</h3>
                    <div class="achievement-icon">üèÜ</div>
                </div>
                <p class="achievement-desc">{{ achievement.description }}</p>
                <div class="achievement-stats">
                    <div class="achievement-stat">
                        <div class="stat-label">Requirement</div>
                        <div class="stat-number">{{ achievement.requirement }}</div>
                    </div>
                    <div class="achievement-stat">
                        <div class="stat-label">Reward</div>
                        <div class="stat-number">
                            {% if achievement.pokemon %}
                                {{ achievement.pokemon.name }}
                            {% else %}
                                No Pok√©mon
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="achievement-actions">
                    <button class="action-btn" onclick="editAchievement({{ achievement.achievement_id }})">Edit</button>
                    <button class="action-btn red" onclick="deleteAchievement({{ achievement.achievement_id }})">Delete</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Pok√©mon Selector Modal -->
    <div class="pokemon-selector-modal" id="pokemonSelectorModal">
        <div class="pokemon-selector-content">
            <h2>Select Pok√©mon Reward</h2>
            <div class="pokemon-grid" id="pokemonGrid">
                <!-- Pok√©mon will be loaded here by JavaScript -->
            </div>
            <div class="pokemon-selector-actions">
                <button class="btn-confirm" onclick="confirmPokemonSelection()">Confirm Selection</button>
                <button class="btn-cancel" onclick="closePokemonSelector()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="editAchievementModal">
        <div class="modal-content">
            <h2>Edit Achievement</h2>
            <p>Editing achievement ID: <span id="editAchieveId"></span></p>
            <div class="modal-actions">
                <button class="btn-confirm" onclick="saveAchievement()">Save Changes</button>
                <button class="btn-cancel" onclick="closeModal('editAchievementModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteAchievementModal">
        <div class="modal-content">
            <h2>Delete Achievement</h2>
            <p>Are you sure you want to delete this achievement? This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="btn-confirm red" onclick="confirmDeleteAchievement()">Delete</button>
                <button class="btn-cancel" onclick="closeModal('deleteAchievementModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="logoutModal">
        <div class="modal-content">
            <h2>Confirm Logout</h2>
            <p>Are you sure you want to logout?</p>
            <div class="modal-actions">
                <button class="btn-confirm" onclick="performLogout()">Yes, Logout</button>
                <button class="btn-cancel" onclick="closeModal('logoutModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Navigation Functions
        function goToDashboard() {
            window.location.href = "{{ url_for('admin_dashboard') }}";
        }

        function showLogoutConfirm() {
            document.getElementById('logoutModal').classList.add('active');
        }

        function performLogout() {
            window.location.href = "{{ url_for('logout') }}";
        }

        // Modal Functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Pok√©mon Data (could be loaded from your database)
        const pokemonList = [
            { id: 1, name: "Bulbasaur", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png" },
            { id: 4, name: "Charmander", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/4.png" },
            { id: 7, name: "Squirtle", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/7.png" },
            { id: 25, name: "Pikachu", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png" },
            { id: 133, name: "Eevee", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/133.png" },
            { id: 143, name: "Snorlax", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/143.png" },
            { id: 152, name: "Chikorita", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/152.png" },
            { id: 155, name: "Cyndaquil", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/155.png" },
            { id: 158, name: "Totodile", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/158.png" },
            { id: 172, name: "Pichu", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/172.png" },
            { id: 175, name: "Togepi", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/175.png" },
            { id: 179, name: "Mareep", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/179.png" },
            { id: 183, name: "Marill", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/183.png" },
            { id: 187, name: "Hoppip", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/187.png" },
            { id: 194, name: "Wooper", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/194.png" },
            { id: 252, name: "Treecko", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/252.png" },
            { id: 255, name: "Torchic", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/255.png" },
            { id: 258, name: "Mudkip", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/258.png" },
            { id: 280, name: "Ralts", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/280.png" },
            { id: 387, name: "Turtwig", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/387.png" },
            { id: 390, name: "Chimchar", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/390.png" },
            { id: 393, name: "Piplup", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/393.png" },
            { id: 495, name: "Snivy", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/495.png" },
            { id: 498, name: "Tepig", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/498.png" },
            { id: 501, name: "Oshawott", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/501.png" },
            { id: 650, name: "Chespin", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/650.png" },
            { id: 653, name: "Fennekin", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/653.png" },
            { id: 656, name: "Froakie", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/656.png" },
            { id: 722, name: "Rowlet", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/722.png" },
            { id: 725, name: "Litten", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/725.png" },
            { id: 728, name: "Popplio", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/728.png" },
            { id: 810, name: "Grookey", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/810.png" },
            { id: 813, name: "Scorbunny", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/813.png" },
            { id: 816, name: "Sobble", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/816.png" },
            { id: 906, name: "Sprigatito", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/906.png" },
            { id: 909, name: "Fuecoco", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/909.png" },
            { id: 912, name: "Quaxly", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/912.png" }
        ];

        // Pok√©mon Selector Functions
        let selectedPokemon = null;

        function showPokemonSelector() {
            const modal = document.getElementById('pokemonSelectorModal');
            const grid = document.getElementById('pokemonGrid');
            
            // Clear previous selections
            grid.innerHTML = '';
            selectedPokemon = null;
            
            // Load Pok√©mon options
            pokemonList.forEach(pokemon => {
                const pokemonOption = document.createElement('div');
                pokemonOption.className = 'pokemon-option';
                pokemonOption.dataset.id = pokemon.id;
                pokemonOption.dataset.name = pokemon.name;
                pokemonOption.dataset.img = pokemon.img;
                pokemonOption.onclick = function() {
                    selectPokemon(this);
                };
                
                pokemonOption.innerHTML = `
                    <div class="pokemon-icon">
                        <img src="${pokemon.img}" alt="${pokemon.name}">
                    </div>
                    <div class="pokemon-name">${pokemon.name}</div>
                    <div class="pokemon-id">#${pokemon.id}</div>
                `;
                
                grid.appendChild(pokemonOption);
            });
            
            modal.classList.add('active');
        }

        function closePokemonSelector() {
            document.getElementById('pokemonSelectorModal').classList.remove('active');
        }

        function selectPokemon(element) {
            // Remove selection from all options
            document.querySelectorAll('.pokemon-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked option
            element.classList.add('selected');
            
            // Store selected Pok√©mon
            selectedPokemon = {
                id: element.dataset.id,
                name: element.dataset.name,
                img: element.dataset.img
            };
        }

        function confirmPokemonSelection() {
            if (selectedPokemon) {
                // Update the form with selected Pok√©mon
                document.getElementById('pokemonId').value = selectedPokemon.id;
                document.getElementById('pokemonName').value = selectedPokemon.name;
                
                // Show selected Pok√©mon display
                const display = document.getElementById('selectedPokemonDisplay');
                const img = document.getElementById('selectedPokemonImg');
                const info = document.getElementById('selectedPokemonInfo');
                
                img.src = selectedPokemon.img;
                img.alt = selectedPokemon.name;
                info.textContent = `${selectedPokemon.name} (#${selectedPokemon.id})`;
                display.style.display = 'flex';
                
                // Update button text
                document.querySelector('.select-pokemon-btn').textContent = 'Change Pok√©mon Selection';
                
                // Close modal
                closePokemonSelector();
            } else {
                alert('Please select a Pok√©mon first!');
            }
        }

        // Achievement Functions
        let currentAchievementId = null;

        function addAchievement() {
            const name = document.getElementById('achieveName').value;
            const pokemonId = document.getElementById('pokemonId').value;
            const pokemonName = document.getElementById('pokemonName').value;
            const desc = document.getElementById('achieveDesc').value;
            const req = document.getElementById('achieveReq').value;
            
            if (name && pokemonId && pokemonName && desc && req) {
                // Send AJAX request to add achievement
                fetch('/admin/achievements/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name,
                        pokemon_id: pokemonId,
                        description: desc,
                        requirement: req
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Achievement added successfully!');
                        clearForm();
                        // Refresh page or update grid
                        window.location.reload();
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Network error. Please try again.');
                });
            } else {
                alert('Please fill in all fields and select a Pok√©mon reward');
            }
        }

        function clearForm() {
            document.getElementById('achieveName').value = '';
            document.getElementById('achieveDesc').value = '';
            document.getElementById('achieveReq').value = '';
            document.getElementById('pokemonId').value = '';
            document.getElementById('pokemonName').value = '';
            document.getElementById('selectedPokemonDisplay').style.display = 'none';
            document.querySelector('.select-pokemon-btn').textContent = 'Select Pok√©mon Reward';
        }

        function editAchievement(id) {
            currentAchievementId = id;
            document.getElementById('editAchieveId').textContent = id;
            document.getElementById('editAchievementModal').classList.add('active');
        }

        function saveAchievement() {
            // In real implementation, send AJAX request to save changes
            alert('Achievement ' + currentAchievementId + ' saved successfully!');
            closeModal('editAchievementModal');
        }

        function deleteAchievement(id) {
            currentAchievementId = id;
            document.getElementById('deleteAchievementModal').classList.add('active');
        }

        function confirmDeleteAchievement() {
            // Send AJAX request to delete achievement
            fetch('/admin/achievements/delete/' + currentAchievementId, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Achievement deleted successfully!');
                    // Refresh page or remove from grid
                    window.location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Network error. Please try again.');
            });
            
            closeModal('deleteAchievementModal');
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
{%endblock%}