{%extends 'base.html'%}
{%block title%}<title>Multiple Choice - VocabuLearner</title>{% endblock%}

{%block content%}
    {%block logo_link %}
            <a href="{{ url_for('dashboard') }}" class="logo-link">
                <div class="logo-icon">
                    <div class="pokeball-mini"></div>
                    <div class="pokeball-mini"></div>
                    <div class="pokeball-mini"></div>
                </div>
                VocabuLearner
            </a>
    {% endblock %}
    {%block header%}{%endblock%}

    <main class="quiz-container">
        <!-- Quiz Header -->
        <div class="quiz-header">
            <div class="quiz-title">Vocabulary Master Challenge</div>
            <div class="quiz-stats">
                <div class="stat-box">
                    <div class="stat-value" id="score">0</div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="streak">0</div>
                    <div class="stat-label">Streak</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="questions">1/10</div>
                    <div class="stat-label">Questions</div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-label">
                <span>Question Progress</span>
                <span id="progress-percent">30%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- Question Container -->
        <div class="question-container">
            <div class="question-header">
                <div class="question-number">Question #<span id="question-num">1</span></div>
                <div class="difficulty" id="difficulty">Medium</div>
            </div>
            
            <div class="question-text" id="question-text">
                What is the meaning of the word "Ubiquitous"?
            </div>

            <!-- Timer -->
            <div class="timer-container">
                <div class="timer-label">Time Remaining</div>
                <div class="timer-display" id="timer">00:15</div>
            </div>

            <!-- Options -->
            <div class="options-grid" id="options-grid">
                <!-- Options will be populated by JavaScript -->
            </div>

            <!-- Explanation -->
            <div class="explanation-box" id="explanation-box">
                <div class="explanation-title">üí° Explanation</div>
                <div class="explanation-text" id="explanation-text">
                    "Ubiquitous" comes from Latin "ubique" meaning "everywhere". It's often used in technology contexts to describe things that are everywhere, like smartphones or social media.
                </div>
            </div>

            <!-- Controls -->
            <div class="quiz-controls">
                <button class="control-btn" id="prev-btn" onclick="previousQuestion()" disabled>
                    ‚Üê Previous
                </button>
                
                <div class="streak-display">
                    <div class="streak-icon">üî•</div>
                    <div class="streak-info">
                        <h3>Answer Streak</h3>
                        <p>Get 5 correct in a row for bonus points!</p>
                    </div>
                </div>
                
                <button class="control-btn secondary" id="next-btn" onclick="nextQuestion()" disabled>
                    Next Question ‚Üí
                </button>
            </div>
        </div>
    </main>

    <!-- Score Popup -->
    <div class="score-popup" id="score-popup">
        <div class="score-title">Quiz Complete!</div>
        <div class="score-result">Score: <span id="final-score">0</span></div>
        
        <div class="score-stats">
            <div class="score-stat">
                <div class="score-stat-value" id="final-correct">0</div>
                <div class="score-stat-label">Correct Answers</div>
            </div>
            <div class="score-stat">
                <div class="score-stat-value" id="final-accuracy">0%</div>
                <div class="score-stat-label">Accuracy</div>
            </div>
            <div class="score-stat">
                <div class="score-stat-value" id="final-streak">0</div>
                <div class="score-stat-label">Best Streak</div>
            </div>
        </div>
        
        <div style="display: flex; gap: 20px; justify-content: center;">
            <button class="control-btn" onclick="restartQuiz()">
                üîÑ Play Again
            </button>
            <button class="control-btn secondary" onclick="closePopup()">
                Back to Menu
            </button>
        </div>
    </div>

    <footer class="footer">
        <p>¬© 2025 VocabuLearner - Collect Words, Master Languages, Achieve Greatness</p>
        <p style="margin-top: 10px; font-size: 8px;">Multiple Choice Quiz - Test your vocabulary knowledge!</p>
    </footer>

    <script>
        // Quiz Data
        const quizQuestions = [
            {
                question: "What is the meaning of the word 'Ubiquitous'?",
                options: [
                    "Present everywhere",
                    "Extremely rare",
                    "Beautifully crafted",
                    "Temporarily available"
                ],
                correct: 0,
                explanation: "'Ubiquitous' comes from Latin 'ubique' meaning 'everywhere'. It's often used in technology contexts to describe things that are everywhere, like smartphones or social media.",
                difficulty: "Medium"
            },
            {
                question: "Which word means 'to make less severe'?",
                options: [
                    "Mitigate",
                    "Exacerbate",
                    "Complicate",
                    "Intensify"
                ],
                correct: 0,
                explanation: "'Mitigate' means to make something less severe, serious, or painful. For example: 'The medicine helped to mitigate the pain.'",
                difficulty: "Easy"
            },
            {
                question: "What does 'Serendipity' mean?",
                options: [
                    "The occurrence of events by chance in a happy way",
                    "A planned sequence of events",
                    "A feeling of sadness",
                    "An organized system"
                ],
                correct: 0,
                explanation: "'Serendipity' is the occurrence of events by chance in a happy or beneficial way. It comes from the Persian fairy tale 'The Three Princes of Serendip'.",
                difficulty: "Hard"
            },
            {
                question: "Which word describes someone showing great attention to detail?",
                options: [
                    "Meticulous",
                    "Careless",
                    "Hasty",
                    "Superficial"
                ],
                correct: 0,
                explanation: "'Meticulous' means showing great attention to detail; very careful and precise. Example: 'She was meticulous in her research.'",
                difficulty: "Medium"
            },
            {
                question: "What is the definition of 'Eloquent'?",
                options: [
                    "Fluent or persuasive in speaking or writing",
                    "Quiet and reserved",
                    "Confusing and unclear",
                    "Simple and plain"
                ],
                correct: 0,
                explanation: "'Eloquent' means having or showing the ability to use language clearly and effectively. An eloquent speaker can express ideas powerfully.",
                difficulty: "Easy"
            }
        ];

        // Game State
        let currentQuestionIndex = 0;
        let score = 0;
        let streak = 0;
        let selectedOption = null;
        let isAnswered = false;
        let timer = 15;
        let timerInterval = null;
        let bestStreak = 0;

        // DOM Elements
        const questionText = document.getElementById('question-text');
        const questionNum = document.getElementById('question-num');
        const difficulty = document.getElementById('difficulty');
        const optionsGrid = document.getElementById('options-grid');
        const explanationBox = document.getElementById('explanation-box');
        const explanationText = document.getElementById('explanation-text');
        const scoreElement = document.getElementById('score');
        const streakElement = document.getElementById('streak');
        const questionsElement = document.getElementById('questions');
        const progressFill = document.getElementById('progress-fill');
        const progressPercent = document.getElementById('progress-percent');
        const timerDisplay = document.getElementById('timer');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const scorePopup = document.getElementById('score-popup');

        // Initialize Quiz
        function initQuiz() {
            loadQuestion();
            updateStats();
            startTimer();
        }

        // Load Question
        function loadQuestion() {
            const question = quizQuestions[currentQuestionIndex];
            
            // Reset state
            isAnswered = false;
            selectedOption = null;
            explanationBox.classList.remove('show');
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = true;
            
            // Update question info
            questionText.textContent = question.question;
            questionNum.textContent = currentQuestionIndex + 1;
            difficulty.textContent = question.difficulty;
            difficulty.style.background = 
                question.difficulty === 'Easy' ? '#4CAF50' : 
                question.difficulty === 'Medium' ? '#FF9800' : '#ff4444';
            
            // Clear and create options
            optionsGrid.innerHTML = '';
            const letters = ['A', 'B', 'C', 'D'];
            
            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.innerHTML = `
                    <div class="option-letter">${letters[index]}</div>
                    ${option}
                `;
                optionBtn.onclick = () => selectOption(index, optionBtn);
                optionsGrid.appendChild(optionBtn);
            });
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / quizQuestions.length) * 100;
            progressFill.style.width = `${progress}%`;
            progressPercent.textContent = `${Math.round(progress)}%`;
            
            // Update questions display
            questionsElement.textContent = `${currentQuestionIndex + 1}/${quizQuestions.length}`;
            
            // Reset and start timer
            resetTimer();
        }

        // Select Option
        function selectOption(index, element) {
            if (isAnswered) return;
            
            // Remove selected class from all options
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            element.classList.add('selected');
            selectedOption = index;
            nextBtn.disabled = false;
        }

        // Submit Answer
        function submitAnswer() {
            if (selectedOption === null || isAnswered) return;
            
            isAnswered = true;
            const question = quizQuestions[currentQuestionIndex];
            const options = document.querySelectorAll('.option-btn');
            
            // Stop timer
            clearInterval(timerInterval);
            
            // Mark correct and incorrect answers
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedOption && index !== question.correct) {
                    option.classList.add('incorrect');
                }
                option.style.pointerEvents = 'none';
            });
            
            // Update score and streak
            if (selectedOption === question.correct) {
                score += 10;
                streak++;
                if (streak > bestStreak) bestStreak = streak;
            } else {
                streak = 0;
            }
            
            // Update stats
            updateStats();
            
            // Show explanation
            explanationText.textContent = question.explanation;
            explanationBox.classList.add('show');
        }

        // Next Question
        function nextQuestion() {
            if (!isAnswered && selectedOption !== null) {
                submitAnswer();
                setTimeout(() => {
                    moveToNextQuestion();
                }, 2000);
            } else if (isAnswered) {
                moveToNextQuestion();
            }
        }

        function moveToNextQuestion() {
            if (currentQuestionIndex < quizQuestions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
                startTimer();
            } else {
                showResults();
            }
        }

        // Previous Question
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
                startTimer();
            }
        }

        // Update Stats Display
        function updateStats() {
            scoreElement.textContent = score;
            streakElement.textContent = streak;
        }

        // Timer Functions
        function startTimer() {
            timer = 15;
            updateTimerDisplay();
            clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timer--;
                updateTimerDisplay();
                
                if (timer <= 5) {
                    timerDisplay.classList.add('timer-low');
                }
                
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    if (!isAnswered) {
                        submitAnswer();
                        setTimeout(() => {
                            if (currentQuestionIndex < quizQuestions.length - 1) {
                                currentQuestionIndex++;
                                loadQuestion();
                                startTimer();
                            } else {
                                showResults();
                            }
                        }, 2000);
                    }
                }
            }, 1000);
        }

        function resetTimer() {
            timer = 15;
            updateTimerDisplay();
            timerDisplay.classList.remove('timer-low');
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Show Results
        function showResults() {
            const accuracy = Math.round((score / (quizQuestions.length * 10)) * 100);
            
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-correct').textContent = Math.floor(score / 10);
            document.getElementById('final-accuracy').textContent = `${accuracy}%`;
            document.getElementById('final-streak').textContent = bestStreak;
            
            scorePopup.classList.add('show');
        }

        // Restart Quiz
        function restartQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            streak = 0;
            bestStreak = 0;
            selectedOption = null;
            isAnswered = false;
            
            scorePopup.classList.remove('show');
            initQuiz();
        }

        function closePopup() {
            scorePopup.classList.remove('show');
            alert('Returning to challenges menu...');
        }

        window.onload = initQuiz;
    </script>

{%endblock%}