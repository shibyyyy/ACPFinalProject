{% extends 'base.html' %}


{% block title %}<title>VocabuLearner - Progress</title>{% endblock %}


{% block content %}
    {% block logo_link %}
        <a href="{{ url_for('dashboard') }}" class="logo-link">
            <div class="logo-icon">
                <div class="pokeball-mini"></div>
                <div class="pokeball-mini"></div>
                <div class="pokeball-mini"></div>
            </div>
            VocabuLearner
        </a>
    {% endblock %}
    {% block header %}{% endblock %}


    <div class="progress-container">
        <div class="page-title">
            <h1>Study Progress Analytics</h1>
            <p>Track your vocabulary learning journey and progress statistics</p>
        </div>


        <div class="analytics-main">
            <h2>Study Progress Analytics</h2>


            <!-- Tabs -->
            <div class="time-filter">
                <button class="time-tab active" data-period="weekly">Weekly</button>
                <button class="time-tab" data-period="daily">Daily</button>
                <button class="time-tab" data-period="monthly">Monthly</button>
            </div>


            <!-- Overview -->
            <div class="weekly-overview">
                <h3 id="overview-title">Weekly Overview</h3>
                <div class="weekly-stats">
                    <strong id="overview-stats">
                        Current Week: {{ weekly_total }} words + {{ evolutions }} Pokémon evolved
                    </strong>
                </div>


                <!-- Chart -->
                <div class="bar-chart-container">
                    <div class="chart-title" id="chart-title">Weekly Words Learned</div>
                    <div class="chart-grid" id="chart-grid">
                        {% for date, count in weekly_data.items() %}
                            <div class="bar-column">
                                <div class="bar" style="height: '{{ (count / (weekly_total if weekly_total else 1)) * 90 }}%;'" data-value="{{ count }}">
                                    <div class="bar-value">{{ count }}</div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="day-labels" id="day-labels">
                        {% for date, count in weekly_data.items() %}
                            <div class="day-label">{{ date }}</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>


    <footer class="footer">
        <p>© 2025 VocabuLearner - Study Progress Analytics</p>
    </footer>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.time-tab');


            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    updateChart(this.dataset.period); // ✅ use data-period
                });
            });


            function updateChart(period) {
                const chartGrid = document.getElementById('chart-grid');
                const dayLabels = document.getElementById('day-labels');
                chartGrid.innerHTML = '';
                dayLabels.innerHTML = '';


                let data = {};
                if (period === 'daily') {
                    data = '{{ daily_data|tojson }}';
                    document.getElementById('chart-title').textContent = 'Daily Words Learned';
                    document.getElementById('overview-title').textContent = 'Daily Overview';
                    document.getElementById('overview-stats').textContent = 'Current Day: ' + Object.values(data).reduce((a,b)=>a+b,0) + ' words';
                } else if (period === 'weekly') {
                    data = '{{ weekly_data|tojson }}';
                    document.getElementById('chart-title').textContent = 'Weekly Words Learned';
                    document.getElementById('overview-title').textContent = 'Weekly Overview';
                    document.getElementById('overview-stats').textContent = 'Current Week: ' + Object.values(data).reduce((a,b)=>a+b,0) + ' words';
                } else if (period === 'monthly') {
                    data = '{{ monthly_data|tojson }}';
                    document.getElementById('chart-title').textContent = 'Monthly Words Learned';
                    document.getElementById('overview-title').textContent = 'Monthly Overview';
                    document.getElementById('overview-stats').textContent = 'Current Month: ' + Object.values(data).reduce((a,b)=>a+b,0) + ' words';
                }


                const maxValue = Math.max(...Object.values(data), 1);
                Object.entries(data).forEach(([label, value]) => {
                    const barCol = document.createElement('div');
                    barCol.className = 'bar-column';
                    barCol.innerHTML = `
                        <div class="bar" style="height:${(value/maxValue)*90}%;" data-value="${value}">
                            <div class="bar-value">${value}</div>
                        </div>`;
                    chartGrid.appendChild(barCol);


                    const dayLabel = document.createElement('div');
                    dayLabel.className = 'day-label';
                    dayLabel.textContent = label;
                    dayLabels.appendChild(dayLabel);
                });
            }
        });
    </script>
{% endblock %}

