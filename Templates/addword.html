{%extends 'base.html'%}

{%block title%}<title>VocabuLearner - Add Words</title>{% endblock%}

{%block content%}
    {%block logo_link %}
            <a href="{{ url_for('dashboard') }}" class="logo-link">
                <div class="logo-icon">
                    <div class="pokeball-mini"></div>
                    <div class="pokeball-mini"></div>
                    <div class="pokeball-mini"></div>
                </div>
                VocabuLearner
            </a>
    {% endblock %}
    {%block header%}{%endblock%}
    {{form.hidden_tag()}}
    <!-- WORD ENTRY FORM -->
    <div class="container" id="wordEntry">
        <h1>Add Your Words</h1>
        
        <!-- PokÃ©mon Evolution Area -->
        <div class="pokemon-evolution">
            <h3>Your Vocabulary Partner</h3>
            <div class="pokemon-container">
                <div class="pokemon" id="currentPokemon">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/172.png" class="pokemon-sprite" alt="Pichu">
                    <div class="pokemon-name">Pichu</div>
                </div>
            </div>
            <div class="evolution-progress">
                <div class="evolution-dot" data-stage="0"></div>
                <div class="evolution-dot" data-stage="1"></div>
                <div class="evolution-dot" data-stage="2"></div>
            </div>
            <p>Add words to help your PokÃ©mon evolve!</p>
        </div>
        
        <form class="word-form" id="wordForm">
            <input type="text" placeholder="Word" id="wordInput" required />
            <input type="text" placeholder="Meaning" id="meaningInput" required />
            <textarea placeholder="Example Sentence" id="exampleInput" required></textarea>
            
            <button type="submit" class="btn-primary" id="addWordBtn">Add Word</button>
        </form>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <p>Â© 2025 VocabuLearner</p>
    </footer>

    <script>
        // DOM Elements
        const wordForm = document.getElementById('wordForm');
        const addWordBtn = document.getElementById('addWordBtn');
        const currentPokemon = document.getElementById('currentPokemon');
        const evolutionDots = document.querySelectorAll('.evolution-dot');

        // State variables
        let currentWordCount = 0;
        const totalWordsNeeded = 5;
        let userWords = [];
        let pokemonStage = 0; // 0: Pichu, 1: Pikachu, 2: Raichu
        let totalWordsAdded = 0;
        
        // PokÃ©mon evolution data
        const pokemonEvolutions = [
            {
                name: "Pichu",
                sprite: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/172.png"
            },
            {
                name: "Pikachu",
                sprite: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png"
            },
            {
                name: "Raichu",
                sprite: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/26.png"
            }
        ];

        // Initialize
        updatePokemon();

        // Event Listeners
        wordForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const word = document.getElementById('wordInput').value;
            const meaning = document.getElementById('meaningInput').value;
            const example = document.getElementById('exampleInput').value;
            
            // Validate inputs
            if (!word.trim() || !meaning.trim() || !example.trim()) {
                alert("Please fill in all fields!");
                return;
            }
            
            // Add to user's words
            userWords.push({ word, meaning, example });
            totalWordsAdded++;
            
            // Clear form
            wordForm.reset();
            
            // Update progress
            currentWordCount++;
            
            // Evolve PokÃ©mon based on word count
            if (totalWordsAdded >= 10) {
                evolvePokemon(2);
            } else if (totalWordsAdded >= 5) {
                evolvePokemon(1);
            }
            
            // Check if we've added all words
            if (currentWordCount >= totalWordsNeeded) {
                // Show success message
                setTimeout(() => {
                    alert("ðŸŽ‰ Great! You've added all 5 words!");
                    // You can redirect to practice or dashboard here
                    // window.location.href = "practice.html";
                }, 300);
            }
            
            // Focus on word input for next entry
            document.getElementById('wordInput').focus();
        });
        
        function evolvePokemon(newStage) {
            if (newStage > pokemonStage) {
                pokemonStage = newStage;
                
                // Add evolution animation
                currentPokemon.classList.add('evolving');
                
                // Update PokÃ©mon after animation
                setTimeout(() => {
                    updatePokemon();
                    currentPokemon.classList.remove('evolving');
                    
                    // Show evolution message
                    if (newStage === 1) {
                        alert("âœ¨ Your PokÃ©mon is evolving! Pichu evolved into Pikachu!");
                    } else if (newStage === 2) {
                        alert("âœ¨ Amazing! Your PokÃ©mon has evolved into Raichu!");
                    }
                }, 1000);
            }
        }
        
        function updatePokemon() {
            const pokemonData = pokemonEvolutions[pokemonStage];
            
            const pokemonImg = currentPokemon.querySelector('.pokemon-sprite');
            const pokemonName = currentPokemon.querySelector('.pokemon-name');
            
            if (pokemonImg) pokemonImg.src = pokemonData.sprite;
            if (pokemonName) pokemonName.textContent = pokemonData.name;
            
            // Update evolution progress dots
            evolutionDots.forEach(dot => {
                const stage = parseInt(dot.getAttribute('data-stage'));
                dot.classList.remove('active', 'completed');
                
                if (stage === pokemonStage) {
                    dot.classList.add('active');
                } else if (stage < pokemonStage) {
                    dot.classList.add('completed');
                }
            });
        }
    </script>

{%endblock%}